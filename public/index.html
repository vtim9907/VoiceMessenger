<! doctype html>
<html lang="en" style='margin:0'>

<head>
  <title>index</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
    crossorigin="anonymous">
  <link href="css/main.css" rel="stylesheet">
  <link href="chat/chat.css" rel="stylesheet">
  <link href="card/loading.css" rel="stylesheet">
  <link rel="manifest" href="./manifest.json">
  <script type="text/javascript" src="js/Vue.js"></script>
  <script type="text/javascript" src="js/lame.all.js"></script>
  <script type="text/javascript" src="js/RecordRTC.js"></script>
  <script type="text/javascript" src="./service_worker.js"></script>
</head>

<body onresize='responsive()' class='bd-drak'>
  <div class='wrapper'>
    <nav class="navbar navbar-expand-md flex-column navbar-dark" :style='styleObject' id='sidebar'>
      <div class="container-fluid">
        <div class="container" style="padding-top:1vh;">
          <a class="navbar-brand" href="#">
            <img src="img/logo-voiceMessage.png" alt="" class="d-inline-block align-top">
          </a>
        </div>
        <button class="navbar-toggler justify-content-end" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
          aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
      <div style="padding-top:3vh;">
        <img :src='photo' :style='styleimg'>
      </div>
      <div class="collapse navbar-collapse " id="navbarNav">
        <ul class="navbar-nav flex-column ">
          <li class="nav-item" v-for='i in List'>
            <a class="nav-link" href="#" @click="show(i)"> {{i}} </a>
          </li>
          <a class="nav-link" href="/logout">登出</a>
        </ul>
      </div>
    </nav>
  </div>

  <div id='mainPage' :style='styleObject'>

    <div v-if="Pageshown=='編輯資料'">
      <edit></edit>
    </div>

    <div v-if="Pageshown=='好友'">
      <friends></friends>
    </div>

    <div v-if="Pageshown=='聊天'">
      <chat></chat>
    </div>

    <div v-if="Pageshown=='抽卡'">
      <card></card>
    </div>


    <div v-if="Pageshown=='錄音'">
      <record></record>
    </div>

  </div>:

  <div id='weatherGrid'>
    <div id="sky"></div>
  </div>

  <script type="text/x-template" id="record">
    <div class="row justify-content-center">
      <div class="">
        <div class="col-12 text-center">click picture to start recording</div>
        <img class="w-100" src="/img/microphone.png" @click="clicked()">
      </div>
      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">{{message}}</h5>
            </div>
            <div class="modal-body">
              <canvas class="w-100 h-75 border rounded border-primary" id="canvas"></canvas>
              <audio class="col-8 d-none" :id="i" controls v-for="i in audioList"></audio> 
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal" v-if="showButton">Close</button>
              <button type="button" class="btn btn-primary" @click="encode()" v-if="showButton">record</button>
              <button type="button" class="btn btn-primary" @click="play()" v-if="showButton">play</button>
            </div>
          </div>
        </div>
      </div>
    </div >   
    </script>

  <script type="text/x-template" id="edit">
        <div class="container" style="padding-top:5vh;">
          <div class="text-center editForm"  style="border-radius: 15px; padding:15px;">
            <h1>編輯個人檔案</h1><hr /><br>
            <form id="register" action="/editProfile" method="post" enctype="multipart/form-data">
              <div class="form-group row">
                <label class="col-form-label  col-sm-2">暱稱</label>
                <div class="col-sm-4">
                  <input type="text" name="nickname" class="form-control" v-model="name">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-form-label  col-sm-2">性別</label>
                <div class="col-sm-2">
                  <div v-if="gender==0">
                  <select name="gender" form="register" class="form-control">
                    <option value="0" selected="selected">保密</option>
                    <option value="1">男</option>
                    <option value="2">女</option>
                  </select>
                  </div>
                  <div v-if="gender==1">
                  <select name="gender" form="register" class="form-control">
                    <option value="0">保密</option>
                    <option value="1" selected="selected">男</option>
                    <option value="2">女</option>
                  </select>
                  </div>
                  <div v-if="gender==2">
                  <select name="gender" form="register" class="form-control">
                    <option value="0">保密</option>
                    <option value="1">男</option>
                    <option value="2" selected="selected">女</option>
                  </select>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-form-label  col-sm-2">年齡</label>
                <div class="col-sm-1">
                  <input type="number" name="age" class="form-control" min="1" step="1" v-model="age">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-form-label  col-sm-2">更換大頭照</label>
                <div class="col-sm-4 text-left">
                  <label class="custom-file">
                    <input type="file"  class="custom-file-input" accept="image/*" name="myphoto" onchange="$(this).next().after().text($(this).val().split('\\').slice(-1)[0])">
                    <span class="custom-file-control"></span>
                  </label>
                </div>
              </div>
              <br><br>
              <button class="btn btn-lg btn-primary btn-block" type="submit">Submit</button>
            </form> 
          </div>
        </div>
    </script>

  <script type='text/x-template' id="friends">
    <div class='d-flex justify-content-center text-center' style='padding:16px'>
      <div class="text-center" v-if="not_found">
        <div class="container">
          <h1>還沒有朋友...</h1>
        </div>
      </div>
      <div v-else>
        <div class="container row">
          <div class="col-sm-4" style="width: 450px; hight: 450px;" v-for='i in lists'>
            <img class="card-img-top" :src="i.photoPath" alt="Card image cap">
            <div class="card-block justify-content-center text-center">
              <h3 class="card-title"> {{i.nickname}}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-template" id="card">
    <div id="card_container">
      <keep-alive>
        <component :is="currentView" :name="name" :photo="photo" :voice="voice"></component>
      </keep-alive>
    </div>
  </script>

  <script type="text/x-template" id="card_loading">
    <div class="sk-folding-cube">
      <div class="sk-cube1 sk-cube"></div>
      <div class="sk-cube2 sk-cube"></div>
      <div class="sk-cube4 sk-cube"></div>
      <div class="sk-cube3 sk-cube"></div>
    </div>
  </script>

  <script type="text/x-template" id="card_content">
    <div>
      <div class="card text-center" style="width:20rem;">
        <img class="card-img-top" :src="photo" >
        <div class="card-body">
          <h1 class="card-title">{{name}}</h1>
        </div>
        <div class="card-body">
          <audio id="voice" @ended="handleEnded()">
            <source :src="voice" type="audio/mpeg">
          </audio>
          <button type="button" class="btn btn-info btn-lg" @click="playOrStop()">
            <i class="fa fa-play" aria-hidden="true"></i> {{playerMsg}}
          </button>
        </div>
        <br><br>
        <a href="/friendRequest" class="btn btn-primary">送出邀請</a>
      </div>
    </div>
  </script>


  <!-- <script type="text/x-template" id="chat">
      <div class="row">
        <div class="userListContainer col-sm-3">
          <div class="panel-heading">
            <i class="fa fa-user-circle-o" aria-hidden="true"></i> <span id="chatMemberText">聊天列表</span></span>
          </div>
          <div class="userlist-body">
            <li class="user" ><a href="#">　<img src="https://goo.gl/eKdiuU" class="userthumbnail">　<span>小智</span></a></li>
          </div>
        </div>
        <div class="chatContainer col-sm-7">
          <div class="panel-heading">
            <i class="fa fa-user-circle-o" aria-hidden="true"></i> 　<span id="chatroomNameText">聊天室</span><span class="name">Doge</span>
          </div>
          <section class="messageFlow">
          </section>
          <div class="inputContainer">
            <form action="">
              <input id="message" autocomplete="off" placeholder="Type your message..."><button id="send">Send</button>
            </form>
          </div>
        </div>
      </div>
    </script> -->

  <script type="text/x-template" id="chat">
      <div class="container h-100" style='padding:16px'>
        <div class="text-center" v-if="not_found">
          <div class="container">
            <h1>還沒有朋友...</h1>
          </div>
        </div>
        <div v-else>
          <div class="row">
            <div class="col-sm-2">
             <ul class="list-group" style="">
                <li class="list-group-item userName" v-for="i in userList" @click="selectReceiver(i)">{{i}}</li>
             </ul>
            </div>
            <div class="col-sm-6 chatBox">
              <ul id="chatList" class="w-100 border border-dark h-75 list-group customScrollBar scrollbar" style="overflow:scroll;">
                <div v-for="i in content">
                  <div v-if="i.name1 == myName" class="customScrollBar">
                    <li class="list-group-item beautify  userText" >{{i.message}}</li>
                  </div>
                  <div v-else>
                    <li class="list-group-item otherChat beautify  otherText" >{{i.name1}} : {{i.message}}</li>
                  </div>
                </div>
              </ul>
              <br>
              <textarea id="chatTextarea" name='test' class="w-100" rows="4" @keydown.enter.prevent="send" placeholder="請輸入訊息..."></textarea>
            </div>
          </div>
        </div>
      </div>
    </script>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
    crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
  <script src=" https://cdn.jsdelivr.net/npm/vue"></script>
  <script type="text/javascript" src="js/record.js"></script>
  <script type="text/javascript" src="card/card.js"></script>
  <script type="text/javascript" src="grid/grid.js"></script>
  <script type="text/javascript" src="chat/chat.js"></script>
  <script type="text/javascript" src="friends/friends.js"></script>
  <script type="text/javascript" src="edit/edit.js"></script>
  <script type='text/javascript' src='js/sidebar.js'></script>
  <script type="text/javascript" src="js/register.js"></script>
</body>

</html>